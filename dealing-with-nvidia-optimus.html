<!DOCTYPE html>
<html lang="en">
<head>
          <title>Yee</title>
        <meta charset="utf-8" />
        <link href="https://superdanby.github.io/Blog/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Yee Full Atom Feed" />
        <link href="https://superdanby.github.io/Blog/feeds/fedora.atom.xml" type="application/atom+xml" rel="alternate" title="Yee Categories Atom Feed" />


    <meta name="tags" content="Fedora" />
    <meta name="tags" content="Nvidia" />
    <meta name="tags" content="Optimus" />
    <meta name="tags" content="Negativo17" />
    <meta name="tags" content="Bumblebee" />

</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="https://superdanby.github.io/Blog/">Yee <strong></strong></a></h1>
        </header><!-- /#banner -->
        <nav id="menu"><ul>
        </ul></nav><!-- /#menu -->
<section id="content" class="body">
  <header>
    <h2 class="entry-title">
      <a href="https://superdanby.github.io/Blog/dealing-with-nvidia-optimus.html" rel="bookmark"
         title="Permalink to Dealing with Nvidia Optimus">Dealing with Nvidia Optimus</a></h2>
 
  </header>
  <footer class="post-info">
    <time class="published" datetime="2017-07-24T18:30:00+08:00">
      Mon 24 July 2017
    </time>
    <address class="vcard author">
      By           <a class="url fn" href="https://superdanby.github.io/Blog/author/chen-duo-yuan.html">陳鐸元</a>
    </address>
  </footer><!-- /.post-info -->
  <div class="entry-content">
    <p>Since the release of Fedora 26, Mesa doesn't conflict with Nvidia anymore. Generally, the Nvidia driver can be installed from either <a href="https://fedoraproject.org/wiki/Bumblebee">Bumblebee</a> or <a href="https://negativo17.org/nvidia-driver/">Negativo17's repo</a>. Both methods are easy to install, but the former one is likely to have more problems.</p>
<p>A brief comparison table:</p>
<table>
<thead>
<tr>
<th></th>
<th>Bumblebee</th>
<th>Negativo17</th>
</tr>
</thead>
<tbody>
<tr>
<td>Nvidia Driver Version</td>
<td>Old</td>
<td>Up to date</td>
</tr>
<tr>
<td>Usage</td>
<td>Turn on when needed</td>
<td>Always on with Nvidia Optimus</td>
</tr>
<tr>
<td>Status</td>
<td>No updates since 2013</td>
<td>Still being maintained and has <a href="https://negativo17.org/nvidia-driver/#reply-title">good support</a></td>
</tr>
<tr>
<td>Platform</td>
<td>Wayland &amp; X</td>
<td>Only on X</td>
</tr>
</tbody>
</table>
<p>I'd like to have more battery life with my laptop. Thus, Bumblebee seems to be a good choice at first glance. However, there are various issues with it. Some are listed <a href="https://fedoraproject.org/wiki/Bumblebee#Troubleshooting">here</a>, and lots of them are listed <a href="https://github.com/Bumblebee-Project/Bumblebee/issues">here</a>. A major reason is that the Bumblebee project has been lack of support for a <strong>looooong</strong> time. Also Bumblebee is not compatible with <a href="http://linrunner.de/en/tlp/tlp.html">TLP</a>(I have tried the recommended <a href="http://linrunner.de/en/tlp/docs/tlp-faq.html#nvidia">fix</a>, but it was in vain.). At last, I gave up on Bumblebee.</p>
<p>But, how can I disable the Nvidia card without Bumblebee? The only way is to prevent the Nvidia modules to load at boot time. After trying for days, I came up with the following solution:</p>
<ul>
<li>Create a new Nvidia-enabled entry at the bottom of the Grub menu:<ul>
<li>Add a new entry to /etc/grub.d/40_custom. Just simply copy the newest entry from /boot/efi/EFI/fedora/grub.cfg.</li>
</ul>
</li>
<li>Disable Nvidia modules on all boot entries except customized ones:<ul>
<li>Add modprobe.blacklist=nvidia,nvidia_drm,nvidia_modeset to GRUB_CMDLINE in /etc/default/grub.</li>
</ul>
</li>
<li>Regenerate Grub Menu:<ul>
<li><code>sudo grub2-mkconfig -o /boot/efi/EFI/fedora/grub.cfg</code></li>
</ul>
</li>
</ul>
<p><a href="https://gist.github.com/Superdanby/12ce20158300c378d4e0f196b279d388#file-blacklistnvidia-sh">This script</a> does the work above. To run it, you have to disable Secure Boot.</p>
<p>I've made sure the method above is effective with <code>tlp-stat</code>. On my laptop, if the Nvidia card is on, the electric current will not be lower than 1300mA; Otherwise, it can be as low as 750mA.</p>
<p>As of now, my Nvidia card is usually off. And it can be turned on if I boot from the last entry in Grub.</p>
  </div><!-- /.entry-content -->
</section>
        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>,
                which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->
        </footer><!-- /#contentinfo -->
</body>
</html>