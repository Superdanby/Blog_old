<!DOCTYPE html>
<html lang="en">
<head>
          <title>Yee</title>
        <meta charset="utf-8" />
        <link href="https://superdanby.github.io/Blog/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Yee Full Atom Feed" />
        <link href="https://superdanby.github.io/Blog/feeds/fedora.atom.xml" type="application/atom+xml" rel="alternate" title="Yee Categories Atom Feed" />


    <meta name="tags" content="Fedora" />
    <meta name="tags" content="Yee" />
    <meta name="tags" content="Secure Boot" />
    <meta name="tags" content="MOK" />

</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="https://superdanby.github.io/Blog/">Yee <strong></strong></a></h1>
        </header><!-- /#banner -->
        <nav id="menu"><ul>
        </ul></nav><!-- /#menu -->
<section id="content" class="body">
  <header>
    <h2 class="entry-title">
      <a href="https://superdanby.github.io/Blog/signing-kernel-modules-for-secure-boot.html" rel="bookmark"
         title="Permalink to Signing Kernel Modules for Secure Boot">Signing Kernel Modules for Secure Boot</a></h2>
 
  </header>
  <footer class="post-info">
    <time class="published" datetime="2017-05-25T13:46:00+08:00">
      Thu 25 May 2017
    </time>
    <address class="vcard author">
      By           <a class="url fn" href="https://superdanby.github.io/Blog/author/chen-duo-yuan.html">陳鐸元</a>
    </address>
  </footer><!-- /.post-info -->
  <div class="entry-content">
    
<h2 id="preparation">Preparation</h2>
<p>Make sure your Secure Boot is off.
In order to sign the modules, they should <strong>exist</strong> in the current environment.
Turning on Secure Boot will block the modules to load in the first place.</p>
<h2 id="key-creation">Key Creation</h2>
<h3 id="create-signing-keys">Create Signing Keys</h3>
<p><code>openssl req -new -x509 -newkey rsa:2048 -keyout MOK.priv -outform DER -out MOK.der -nodes -days 36500 -subj "/CN=Descriptive name/"</code>
<em>Descriptive name</em> is the name of the key. E.g. <code>"/CN=Yee~"</code></p>
<h3 id="sign-the-module">Sign the Module</h3>
<p><code>sudo /usr/src/kernels/$(uname -r)/scripts/sign-file sha256 ./MOK.priv ./MOK.der $(modinfo -n</code> <em>MODULE_NAME</em> <code>)</code>
Note that you can sign multiple modules at a time. Just repeat this step until all modules are signed.</p>
<h3 id="register-the-keys-with-machine-owner-key">Register the Keys with Machine Owner Key</h3>
<p><code>sudo mokutil --import MOK.der</code>
You'll be prompt to enter a password for later use in MOK.</p>
<h3 id="reboot">Reboot</h3>
<p><code>reboot</code></p>
<h2 id="mok-enrollment">MOK Enrollment</h2>
<ol>
<li>Press anykey to enter MOK within 10 seconds.</li>
<li>Enroll MOK</li>
<li>Continue</li>
<li>Insert the password you just created.</li>
<li>OK</li>
</ol>
<p><em><a href="https://superdanby.github.io/Blog/managing-signed-keys-with-machine-owner-key.html">**More with MOK</a></em></p>
<h2 id="check-if-the-module-is-signed">Check if the Module is Signed</h2>
<p><code>mokutil --list-enrolled</code></p>
<h2 id="done">Done!</h2>
<p>You can now turn Secure Boot back on!</p>
  </div><!-- /.entry-content -->
</section>
        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>,
                which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->
        </footer><!-- /#contentinfo -->
</body>
</html>